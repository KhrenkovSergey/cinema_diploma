/*! For license information please see admin.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(){n=function(){return r};var t,r={},a=Object.prototype,o=a.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",s=c.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var a=e&&e.prototype instanceof b?e:b,o=Object.create(a.prototype),c=new B(r||[]);return i(o,"_invoke",{value:O(t,n,c)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=d;var p="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function E(){}function w(){}var _={};f(_,l,(function(){return this}));var L=Object.getPrototypeOf,x=L&&L(L(C([])));x&&x!==a&&o.call(x,l)&&(_=x);var k=w.prototype=b.prototype=Object.create(_);function I(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,n){function r(a,i,c,l){var u=h(t[a],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==e(f)&&o.call(f,"__await")?n.resolve(f.__await).then((function(t){r("next",t,c,l)}),(function(t){r("throw",t,c,l)})):n.resolve(f).then((function(t){s.value=t,c(s)}),(function(t){return r("throw",t,c,l)}))}l(u.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new n((function(n,a){r(t,e,n,a)}))}return a=a?a.then(o,o):o()}})}function O(e,n,r){var a=p;return function(o,i){if(a===v)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:t,done:!0}}for(r.method=o,r.arg=i;;){var c=r.delegate;if(c){var l=T(c,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===p)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=v;var u=h(e,n,r);if("normal"===u.type){if(a=r.done?y:m,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=y,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=h(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function C(n){if(n||""===n){var r=n[l];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,i=function e(){for(;++a<n.length;)if(o.call(n,a))return e.value=n[a],e.done=!1,e;return e.value=t,e.done=!0,e};return i.next=i}}throw new TypeError(e(n)+" is not iterable")}return E.prototype=w,i(k,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:E,configurable:!0}),E.displayName=f(w,s,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,f(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},r.awrap=function(t){return{__await:t}},I(S.prototype),f(S.prototype,u,(function(){return this})),r.AsyncIterator=S,r.async=function(t,e,n,a,o){void 0===o&&(o=Promise);var i=new S(d(t,e,n,a),o);return r.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(k),f(k,s,"Generator"),f(k,l,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},r.values=C,B.prototype={constructor:B,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,a){return c.type="throw",c.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;N(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:C(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},r}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e,n,r,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,a)}function o(t){return i.apply(this,arguments)}function i(){var t;return t=n().mark((function t(e){var a,o,i,c,l,u,s=arguments;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:"GET",o=s.length>2&&void 0!==s[2]?s[2]:null,t.prev=2,i={method:a,credentials:"include"},o&&(c=new FormData,Object.entries(o).forEach((function(t){var e,n,a=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,c=[],l=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){u=!0,a=t}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],i=a[1];c.append(o,i)})),i.body=c),console.log("Отправка ".concat(a," запроса к ").concat(e)),t.next=8,fetch("/api/".concat(e),i);case 8:if((l=t.sent).ok){t.next=11;break}throw new Error("HTTP error! status: ".concat(l.status));case 11:return t.next=13,l.json();case 13:return u=t.sent,console.log("Получены данные:",u),t.abrupt("return",u);case 18:throw t.prev=18,t.t0=t.catch(2),console.error("API Error:",t.t0),t.t0;case 22:case"end":return t.stop()}}),t,null,[[2,18]])})),i=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){a(i,r,o,c,l,"next",t)}function l(t){a(i,r,o,c,l,"throw",t)}c(void 0)}))},i.apply(this,arguments)}t.p="/cinema_diploma/";const c=t.p+"1655dd3b8f6ed28ce21d.png";function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(){s=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),c=new B(r||[]);return a(i,"_invoke",{value:O(t,n,c)}),i}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function b(){}function E(){}function w(){}var _={};f(_,i,(function(){return this}));var L=Object.getPrototypeOf,x=L&&L(L(C([])));x&&x!==n&&r.call(x,i)&&(_=x);var k=w.prototype=b.prototype=Object.create(_);function I(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(a,o,i,c){var u=h(t[a],t,o);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==l(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,i,c)}),(function(t){n("throw",t,i,c)})):e.resolve(f).then((function(t){s.value=t,i(s)}),(function(t){return n("throw",t,i,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(t,r){function a(){return new e((function(e,a){n(t,r,e,a)}))}return o=o?o.then(a,a):a()}})}function O(e,n,r){var a=p;return function(o,i){if(a===v)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:t,done:!0}}for(r.method=o,r.arg=i;;){var c=r.delegate;if(c){var l=T(c,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===p)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=v;var u=h(e,n,r);if("normal"===u.type){if(a=r.done?y:m,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=y,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=h(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function C(e){if(e||""===e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(l(e)+" is not iterable")}return E.prototype=w,a(k,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:E,configurable:!0}),E.displayName=f(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,f(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},I(S.prototype),f(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new S(d(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(k),f(k,u,"Generator"),f(k,i,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=C,B.prototype={constructor:B,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return c.type="throw",c.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;N(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:C(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function f(t,e,n,r,a,o,i){try{var c=t[o](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,a)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){f(o,r,a,i,c,"next",t)}function c(t){f(o,r,a,i,c,"throw",t)}i(void 0)}))}}"true"!==localStorage.getItem("adminAuth")&&(alert("Необходимо авторизоваться для доступа к этой странице."),window.location.href="login.html"),document.addEventListener("DOMContentLoaded",(function(){var t=[],e=[],n=[],r=document.getElementById("halls-list"),a=document.getElementById("add-hall-modal"),i=document.getElementById("add-hall-btn"),l=document.getElementById("add-hall-form"),f=document.getElementById("close-add-hall"),h=document.getElementById("cancel-add-hall"),p=document.getElementById("draggable-films-container"),m=document.getElementById("seance-grid-container"),v=document.getElementById("add-film-btn"),y=document.getElementById("add-film-modal"),g=document.getElementById("add-film-form"),b=document.getElementById("close-add-film-modal"),E=document.getElementById("cancel-add-film"),w=document.getElementById("film-poster-input"),_=document.getElementById("poster-file-name"),L=["#c8e6c9","#fff9c4","#ffcdd2","#d1c4e9","#b2ebf2"],x=document.getElementById("hall-config-form"),k=document.getElementById("hall-config-select"),I=document.getElementById("hall-config-grid"),S=document.getElementById("rows-count"),O=document.getElementById("seats-count"),T=document.getElementById("price-config-form"),j=document.getElementById("price-config-select"),N=document.getElementById("standart-price"),B=document.getElementById("vip-price"),C=document.getElementById("open-sales-form"),P=document.getElementById("sales-hall-select"),A=C?C.querySelector('button[type="submit"]'):null;function M(){r&&(r.innerHTML="<ul>"+t.map((function(t){return"\n            <li>\n              <span>- ".concat(t.hall_name,'</span>\n              <a href="#" class="btn-reset delete-hall-btn" data-hall-id="').concat(t.id,'" aria-label="Удалить зал">\n                <img src="').concat(c,'" alt="Удалить зал">\n              </a>\n            </li>\n        ')})).join("")+"</ul>"||0,[k,j,P,document.getElementById("seance-hall")].forEach((function(e){if(e){var n=e.value;e.innerHTML="<option selected disabled>Выберите зал</option>",t.forEach((function(t){e.innerHTML+='<option value="'.concat(t.id,'">').concat(t.hall_name,"</option>")})),t.some((function(t){return t.id==n}))&&(e.value=n)}}))),p&&(p.innerHTML="",e.forEach((function(t,e){var n=document.createElement("div");n.className="film-item-draggable",n.style.backgroundColor=L[e%L.length],n.innerHTML='\n                <div class="dnd-film-item__poster-wrapper">\n                    <div class="dnd-film-item__poster" style="background-image: url('.concat(t.film_poster,');"></div>\n                </div>\n                <div class="film-item-draggable__info">\n                    <h5 class="film-item-draggable__title">').concat(t.film_name,'</h5>\n                    <p class="film-item-draggable__duration">').concat(t.film_duration,' мин.</p>\n                </div>\n                 <a href="#" class="btn-reset delete-film-btn" data-film-id="').concat(t.id,'" aria-label="Удалить фильм">\n                    <img src="').concat(c,'" alt="Удалить фильм">\n                 </a>\n            '),p.appendChild(n)}))),function(){if(m){m.innerHTML="<h5>Сетка сеансов</h5>";var r=document.createElement("ul");n.forEach((function(n){var a=e.find((function(t){return t.id===n.seance_filmid})),o=t.find((function(t){return t.id===n.seance_hallid}));if(a&&o){var i=document.createElement("li");i.textContent='Фильм "'.concat(a.film_name,'" в зале "').concat(o.hall_name,'" в ').concat(n.seance_time),r.appendChild(i)}})),0===n.length?m.innerHTML+="<p>Сеансов пока нет.</p>":m.appendChild(r)}}()}function G(){return H.apply(this,arguments)}function H(){return(H=d(s().mark((function a(){var i;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o("alldata");case 2:(i=a.sent)&&i.success?(t=i.result.halls||[],e=i.result.films||[],n=i.result.seances||[],M(),Y()):r&&(r.innerHTML='<p class="text-danger">Не удалось загрузить данные о залах.</p>');case 4:case"end":return a.stop()}}),a)})))).apply(this,arguments)}i&&i.addEventListener("click",(function(){return a.classList.remove("hidden")})),f&&f.addEventListener("click",(function(){return a.classList.add("hidden")})),h&&h.addEventListener("click",(function(){return a.classList.add("hidden")})),l&&l.addEventListener("submit",function(){var t=d(s().mark((function t(e){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),n=l.querySelector('[name="hallName"]').value.trim()){t.next=4;break}return t.abrupt("return",alert("Название зала не может быть пустым."));case 4:return t.next=6,o("hall","POST",{hallName:n});case 6:if(!(r=t.sent)||!r.success){t.next=14;break}return a.classList.add("hidden"),l.reset(),t.next=12,G();case 12:t.next=15;break;case 14:alert(r.error||"Произошла неизвестная ошибка.");case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),r&&r.addEventListener("click",function(){var t=d(s().mark((function t(e){var n,r,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.target.closest(".delete-hall-btn"))){t.next=14;break}if(e.preventDefault(),r=n.dataset.hallId,!confirm("Вы уверены, что хотите удалить этот зал? Это действие необратимо.")){t.next=14;break}return t.next=7,o("hall/".concat(r),"DELETE");case 7:if(!(a=t.sent)||!a.success){t.next=13;break}return t.next=11,G();case 11:t.next=14;break;case 13:alert(a.error||"Не удалось удалить зал.");case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),v&&v.addEventListener("click",(function(){return y.classList.remove("hidden")})),b&&b.addEventListener("click",(function(){return y.classList.add("hidden")})),E&&E.addEventListener("click",(function(){return y.classList.add("hidden")})),w&&w.addEventListener("change",(function(){w.files.length>0?_.textContent=w.files[0].name:_.textContent="Файл не выбран"})),g&&g.addEventListener("submit",function(){var t=d(s().mark((function t(e){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),(n=new FormData).append("filmName",document.getElementById("film-title-input").value),n.append("filmDuration",document.getElementById("film-duration-input").value),n.append("filmDescription",document.getElementById("film-description-input").value),n.append("filmOrigin",document.getElementById("film-origin-input").value),w.files[0]&&n.append("filePoster",w.files[0]),t.next=9,o("film","POST",n);case 9:if(!(r=t.sent)||!r.success){t.next=18;break}return y.classList.add("hidden"),g.reset(),_.textContent="Файл не выбран",t.next=16,G();case 16:t.next=19;break;case 18:alert(r.error||"Произошла ошибка при добавлении фильма.");case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var D=null;function F(){if(I){var t=parseInt(S.value,10)||0,e=parseInt(O.value,10)||0,n=D?D.hall_config:[];I.innerHTML="";for(var r=0;r<t;r++){var a=document.createElement("div");a.className="hall-config__row";for(var o=0;o<e;o++){var i=document.createElement("div"),c=n&&n[r]&&n[r][o]?n[r][o]:"standart";i.className="hall-config__seat hall-config__seat--".concat(c),a.appendChild(i)}I.appendChild(a)}}}k&&k.addEventListener("change",(function(){(D=t.find((function(t){return t.id==k.value})))&&(S.value=D.hall_rows,O.value=D.hall_places,F())})),[S,O].forEach((function(t){t&&t.addEventListener("input",(function(){D?F():(alert("Сначала выберите зал, чтобы менять его размеры."),S.value="",O.value="")}))})),I&&I.addEventListener("click",(function(t){if(t.target.matches(".hall-config__seat")){var e=t.target.classList;e.contains("hall-config__seat--standart")?e.replace("hall-config__seat--standart","hall-config__seat--vip"):e.contains("hall-config__seat--vip")?e.replace("hall-config__seat--vip","hall-config__seat--disabled"):e.replace("hall-config__seat--disabled","hall-config__seat--standart")}})),x&&x.addEventListener("submit",function(){var t=d(s().mark((function t(e){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),D){t.next=3;break}return t.abrupt("return",alert("Сначала выберите зал для конфигурации."));case 3:return n=Array.from(I.querySelectorAll(".hall-config__row")).map((function(t){return Array.from(t.querySelectorAll(".hall-config__seat")).map((function(t){return t.classList.contains("hall-config__seat--vip")?"vip":t.classList.contains("hall-config__seat--disabled")?"disabled":"standart"}))})),r={rowCount:S.value,placeCount:O.value,config:JSON.stringify(n)},t.next=7,o("hall/".concat(D.id),"POST",r);case 7:if(null===t.sent){t.next=12;break}return alert("Конфигурация зала успешно сохранена!"),t.next=12,G();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var q=null;j&&j.addEventListener("change",(function(){(q=t.find((function(t){return t.id==j.value})))&&(N.value=q.hall_price_standart,B.value=q.hall_price_vip)})),T&&T.addEventListener("submit",function(){var t=d(s().mark((function t(e){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),q){t.next=3;break}return t.abrupt("return",alert("Сначала выберите зал для конфигурации цен."));case 3:return n={priceStandart:N.value,priceVip:B.value},t.next=6,o("price/".concat(q.id),"POST",n);case 6:if(null===t.sent){t.next=11;break}return alert("Цены успешно сохранены!"),t.next=11,G();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var U=null;function Y(){var r=document.getElementById("dnd-films-list"),a=document.getElementById("dnd-timelines");if(r&&a){r.innerHTML="",r.className="row gy-3",e.forEach((function(t){var e=document.createElement("div");e.className="col-md-4";var n=document.createElement("div");n.className="dnd-film-item",n.draggable=!0,n.dataset.filmId=t.id,n.dataset.duration=t.film_duration;var a=L[t.id%L.length];n.style.backgroundColor=a;var o=document.createElement("div");o.className="dnd-film-item__poster";try{var i=new URL(t.film_poster);o.style.backgroundImage="url(".concat(i.pathname,")")}catch(e){console.error("Invalid poster URL: ".concat(t.film_poster))}var l=document.createElement("div");l.className="dnd-film-item__info",l.innerHTML='\n                <h5 class="dnd-film-item__title">'.concat(t.film_name,'</h5>\n                <p class="dnd-film-item__duration">').concat(t.film_duration," мин.</p>\n            ");var u=document.createElement("a");u.href="#",u.className="btn-reset delete-film-btn",u.dataset.filmId=t.id,u.setAttribute("aria-label","Удалить фильм"),u.innerHTML='<img src="'.concat(c,'" alt="Удалить фильм">'),n.appendChild(o),n.appendChild(l),n.appendChild(u),e.appendChild(n),r.appendChild(e)})),a.innerHTML="";var i=1440;t.forEach((function(t){var r=document.createElement("div");r.className="dnd-hall-block",r.innerHTML='<h5 class="dnd-hall-block__title">'.concat(t.hall_name,"</h5>");var o=document.createElement("div");o.className="dnd-timeline",o.dataset.hallId=t.id,n.filter((function(e){return e.seance_hallid===t.id})).forEach((function(t){var n,r,a=e.find((function(e){return e.id===t.seance_filmid}));if(a){var c=a.film_duration,l=(n=t.seance_time.split(":").map(Number),r=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,c=[],l=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){u=!0,a=t}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(n,r)||function(t,e){if(t){if("string"==typeof t)return u(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=60*l[0]+l[1],f=document.createElement("div");f.className="dnd-seance",f.draggable=!0,f.dataset.seanceId=t.id,f.dataset.filmId=a.id;var d=L[a.id%L.length];f.style.backgroundColor=d,f.style.left="".concat(s/i*100,"%"),f.style.width="".concat(c/i*100,"%"),f.innerHTML='\n                    <p class="dnd-seance__title">'.concat(a.film_name,'</p>\n                    <p class="dnd-seance__time">').concat(t.seance_time,'</p>\n                    <button class="btn-reset dnd-seance__delete" data-seance-id="').concat(t.id,'">&times;</button>\n                '),o.appendChild(f)}})),r.appendChild(o),a.appendChild(r)}));var l=null;r.addEventListener("dragstart",(function(t){t.target.classList.contains("dnd-film-item")&&(l=t.target)})),a.addEventListener("dragstart",(function(t){t.target.classList.contains("dnd-seance")&&(l=t.target)})),a.addEventListener("dragover",(function(t){t.preventDefault()})),a.addEventListener("drop",function(){var t=d(s().mark((function t(e){var n,r,a,c,u,f,d,h,p,m;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),(n=e.target.closest(".dnd-timeline"))&&l){t.next=4;break}return t.abrupt("return");case 4:if(r=n.dataset.hallId,a=n.getBoundingClientRect(),c=e.clientX-a.left,u=Math.round(c/a.width*i),f=Math.floor(u/60),d=u%60,h="".concat(String(f).padStart(2,"0"),":").concat(String(d).padStart(2,"0")),p=l.dataset.filmId,!l.classList.contains("dnd-film-item")){t.next=22;break}return t.next=15,o("seance","POST",{seanceHallid:r,seanceFilmid:p,seanceTime:h});case 15:if(!(m=t.sent)||!m.success){t.next=21;break}return t.next=19,G();case 19:t.next=22;break;case 21:alert(m.error||"Ошибка добавления сеанса");case 22:l=null;case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),a.addEventListener("click",function(){var t=d(s().mark((function t(e){var n,r,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.target.closest(".dnd-seance__delete"))){t.next=13;break}if(r=n.dataset.seanceId,!confirm("Удалить этот сеанс?")){t.next=13;break}return t.next=6,o("seance/".concat(r),"DELETE");case 6:if(!(a=t.sent)||!a.success){t.next=12;break}return t.next=10,G();case 10:t.next=13;break;case 12:alert(a.error||"Не удалось удалить сеанс.");case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}P&&P.addEventListener("change",(function(){U=t.find((function(t){return t.id==P.value})),function(){if(A)if(U){var t=1===Number(U.hall_open);A.textContent=t?"Приостановить продажу билетов":"Открыть продажу билетов",A.classList.toggle("btn-danger",t),A.classList.toggle("btn-primary",!t),A.disabled=!1}else A.textContent="Выберите зал",A.disabled=!0}()})),C&&C.addEventListener("submit",function(){var t=d(s().mark((function t(e){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),U){t.next=3;break}return t.abrupt("return",alert("Сначала выберите зал."));case 3:return n={hallOpen:1===Number(U.hall_open)?"0":"1"},t.next=6,o("open/".concat(U.id),"POST",n);case 6:if(null===t.sent){t.next=11;break}return alert("Статус продаж успешно изменен!"),t.next=11,G();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),G()}))})();